---
title: "ä½¿ç”¨ Act æœ¬åœ°è¿è¡Œ GitHub Actions"
description:
date: 2024-06-24T22:24:54+08:00
image:
math:
license:
hidden: false
comments: true
draft: false
categories:
  - ç¼–ç¨‹
tags:
  - github-action
toc: true
---

![](https://github.githubassets.com/assets/actions-workflow-c4f06bca5ec2.svg)

## ç®€ä»‹

GitHub Actions ä¸ºä»“åº“å¼€å‘è€…æä¾›äº†æ‰§è¡Œå®šåˆ¶åŒ– Job çš„èƒ½åŠ›ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨å„ç§ Job åŸºäºä»£ç ä»“åº“è¿è¡Œæµ‹è¯•ã€æ„å»ºã€å‘å¸ƒç­‰æ“ä½œï¼Œå®ç° CI/CD ç­‰å·¥ä½œæµã€‚

è¿™äº› Job é»˜è®¤è¿è¡Œåœ¨ GitHub æä¾›çš„ runner ä¸­ï¼Œä½†æ˜¯ç”±äºä»“åº“ä¼—å¤šï¼Œé…ç½®äº† actions çš„ä»£ç ä»“åº“æœªå¿…èƒ½å¾—åˆ°è¶³å¤Ÿçš„èµ„æº (runner) æ¥å¿«é€Ÿã€é«˜æ•ˆçš„è¿è¡Œä»£ç ä»“åº“çš„ Actionsã€‚

<!--more-->

ä¸€ä¸ªå¯è¡Œçš„æ–¹å¼æ˜¯ç»‘å®šè‡ªå·±çš„ç§æœ‰ runner åˆ°ä»£ç ä»“åº“ï¼Œè¿™æ ·æ¯æ¬¡æ‰§è¡Œ Job æ—¶éƒ½ä¼šåœ¨è‡ªå·±çš„ runner ä¸Šï¼Œè¯¦æƒ…è§ [self-hosted runners](https://docs.github.com/en/actions/hosting-your-own-runners/managing-self-hosted-runners/about-self-hosted-runners)ã€‚

å¦ä¸€ä¸ªæ–¹æ¡ˆå°±æ˜¯ [act](https://github.com/nektos/act), å¯ä»¥åœ¨ç”µè„‘ä¸Šï¼Œåœ¨ä»£ç ä»“åº“ç›®å½•ä¸‹ï¼Œç›´æ¥æœ¬åœ°è¿è¡Œ Actions ä¸­çš„ Jobã€‚æ–¹ä¾¿å¼€å‘è€…å¿«é€’æœ¬åœ°è¿­ä»£å’Œæµ‹è¯•ï¼Œç¡®è®¤æ²¡é—®é¢˜äº†å†æ›´æ–°åˆ°ä¸»ä»“åº“ï¼Œå‡å°‘ä¸»ä»“åº“æ‰§è¡Œ Actions çš„æ¬¡æ•°ã€‚

## act å®‰è£…

act ä½¿ç”¨ go è¯­è¨€å¼€å‘ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ–è€…ä½¿ç”¨ go install å®‰è£…ã€‚

1. ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶

è¿›å…¥ act çš„ [releases](https://github.com/nektos/act/releases) é¡µé¢æ‰¾åˆ°æœ€æ–°ç‰ˆï¼Œç¬”è€…è¿™é‡Œæ˜¯ `v0.2.63`

![](https://github.com/alwqx/picx-images-hosting/raw/master/blog/2024/act_00.1hs2uunxnh.webp)

é€‰æ‹©å¯¹åº”å¹³å°çš„æ–‡ä»¶ï¼Œç¬”è€…è¿™é‡Œæ˜¯ Mac M èŠ¯ç‰‡ï¼Œé€‰æ‹©`act_Darwin_arm64.tar.gz`, ä¸‹è½½è§£å‹åï¼Œç§»åŠ¨åˆ° PATH ç›®å½•å³å¯ã€‚

2. go install å®‰è£…

é¦–å…ˆä¸‹è½½ä»£ç ä»“åº“

```shell
git clone https://github.com/nektos/act.git
```

è¿›å…¥åˆ° act ç›®å½•ï¼Œè¿è¡Œ `go install`

```shell
$ go install
go: downloading github.com/spf13/cobra v1.8.1
go: downloading golang.org/x/term v0.21.0
go: downloading google.golang.org/protobuf v1.34.2
go: downloading github.com/docker/cli v26.1.4+incompatible
go: downloading golang.org/x/sys v0.21.0
```

go ä¼šè‡ªåŠ¨æ„å»ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶æŠŠæ„å»ºå¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶æ”¾åˆ° gopath ä¸­ï¼Œè¿™æ—¶æŸ¥çœ‹ act ç‰ˆæœ¬ï¼š

```shell
$ act --version
act version 0.2.63
```

## act ä½¿ç”¨

1. è§¦å‘æ¡ä»¶

```shell
# è¿è¡Œ push è§¦å‘çš„ action
act push

# è¿è¡Œ pull_request è§¦å‘çš„ action
act pull_request
```

2. è¿è¡ŒæŒ‡å®š Job

```shell
# -j, --job åé¢è·Ÿ job id
act -j 'test'
```

3. å˜é‡ä¸æœºå¯†å†…å®¹

```shell
# é€šè¿‡ --var æŒ‡å®šå•ä¸ª var
act --var VARIABLE=somevalue
# é€šè¿‡ --var-file æŒ‡å®šæ–‡ä»¶ä¸­çš„å¤šä¸ªå˜é‡
act --var-file my.variables
```

```shell
# é€šè¿‡ -s æŒ‡å®šå•ä¸ªä¿å¯†å€¼
act -s MY_SECRET=somevalue
# é€šè¿‡ --secret-file æŒ‡å®šæ–‡ä»¶ä¸­çš„å¤šä¸ªä¿å¯†å€¼
act --secret-file my.secrets
```

## act runner

act åŒæ ·æœ‰ runner çš„æ¦‚å¿µï¼Œæ”¯æŒåœ¨å®¹å™¨å’Œå®¿ä¸»æœºä¸¤ä¸ªå¹³å°ä½œä¸º runner è¿è¡Œ Actions Jobã€‚åœ¨å®¹å™¨ä¸­è¿è¡Œéœ€è¦æŒ‡å®šå®¹å™¨é•œåƒï¼Œé»˜è®¤é•œåƒæ˜¯ `catthehacker/ubuntu:act-latest`ã€‚å®¿ä¸»æœºæ”¯æŒ Macã€Linux å’Œ Windowsã€‚éœ€è¦æ³¨æ„ï¼Œå®¹å™¨çš„æŒ‡ä»¤é›†æ¶æ„è¦å’Œå®¿ä¸»æœºæ¶æ„ä¸€è‡´ï¼Œå¦‚æœå®¿ä¸»æœºæ˜¯ Windows ç³»ç»Ÿ Intel amd64 æ¶æ„ï¼Œé‚£ä¹ˆé•œåƒä¹Ÿåº”è¯¥æ˜¯ amd64 æ¶æ„ã€‚

å¦‚æœ act é»˜è®¤æä¾›çš„é•œåƒä¸æ»¡è¶³è‡ªå·±çš„éœ€æ±‚ï¼Œå¯ä»¥è‡ªå·±æ„å»ºä¸€ä¸ª runner é•œåƒï¼Œåœ¨è¿è¡Œ act æ—¶é€šè¿‡ `-P`æˆ–è€… `--platform` æŒ‡å®šé•œåƒï¼š

```shell
act -P ubuntu-latest=adolphlwq/act-runner-ubuntu:22.04
```

act ä¸­çš„ runner å’Œ GitHub Runners ä¸€è‡´ï¼ˆè¡¨æ ¼æ¥è‡ª [Standard GitHub-hosted runners for Public repositories](https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners/about-github-hosted-runners#standard-github-hosted-runners-for-public-repositories)ï¼‰ï¼š

| Virtual Machine | Processor (CPU) | Memory (RAM) | Storage (SSD) | Workflow label                                                 | Notes                                                                                      |
| :-------------- | :-------------- | :----------- | :------------ | :------------------------------------------------------------- | :----------------------------------------------------------------------------------------- |
| Linux           | 4               | 16GB         | 14GB          | ubuntu-latest, ubuntu-24.04 [Beta], ubuntu-22.04, ubuntu-20.04 | The ubuntu-latest label currently uses the Ubuntu 22.04 runner image.                      |
| Windows         | 4               | 16GB         | 14GB          | windows-latest, windows-2022, windows-2019                     | The windows-latest label currently uses the Windows 2022 runner image.                     |
| macOS           | 3               | 14GB         | 14GB          | macos-12 or macos-11                                           | The macos-11 label has been deprecated and will no longer be available after 28 June 2024. |
| macOS           | 4               | 14GB         | 14GB          | macos-13                                                       | NA                                                                                         |
| macOS           | 3(M1)           | 7GB          | 14GB          | macos-latest or macos-14                                       | The macos-latest label currently uses the macOS 14 runner image.                           |

**Workflow label **æŒ‡å®šä¸åŒå¹³å°çš„ Runnerï¼Œact ä¸­é€šè¿‡ `-P label=image` æ¥æŒ‡å®šä¸åŒå¹³å°ä½¿ç”¨ä»€ä¹ˆå®¹å™¨é•œåƒè¿è¡Œã€‚å¦‚æœæ²¡æœ‰é•œåƒï¼Œåˆ™å¯ä»¥é€šè¿‡ `-P label=self-hosted`è¡¨ç¤º [act ç›´æ¥åœ¨å®¿ä¸»æœºè¿è¡Œ Actions](https://nektosact.com/usage/runners.html)ã€‚

```shell
act -P ubuntu-latest=-self-hosted
act -P windows-latest=-self-hosted
act -P macos-latest=-self-hosted
```

## act runner çš„å±€é™

act runner ä¸æ˜¯ä¸‡èƒ½çš„ã€‚é¦–å…ˆè¡¨ç¤º runner çš„å¹³å°æ ‡ç­¾ (ubuntu-latest ç­‰ï¼‰è¦å’Œå®¿ä¸»æœºçš„æŒ‡ä»¤æ¶æ„ä¸€è‡´ã€‚æ¯”å¦‚åœ¨ M èŠ¯ç‰‡çš„ è‹¹æœæœºå™¨ä¸Šï¼Œæ˜¯ä¸èƒ½è¿è¡Œ

```shell
# Apple M èŠ¯ç‰‡ä¸èƒ½è¿è¡Œ amd 64 èŠ¯ç‰‡é•œåƒçš„
$ act -P ubuntu-latest=adolphlwq/act-runner-ubuntu:22.04
INFO[0000] Using docker host 'unix:///var/run/docker.sock', and daemon socket 'unix:///var/run/docker.sock'
WARN  âš  You are using Apple M-series chip and you have not specified container architecture, you might encounter issues while running act. If so, try running it with '--container-architecture linux/amd64'. âš 
INFO[0000] Start server on http://192.168.6.234:34567
[release/generate-windows-rocm] ğŸš§  Skipping unsupported platform -- Try running with `-P windows=...`
[release/build-linux-arm64    ] ğŸš§  Skipping unsupported platform -- Try running with `-P linux-arm64=...`
[release/build-darwin         ] ğŸš§  Skipping unsupported platform -- Try running with `-P macos-12=...`
[release/generate-windows-cpu ] ğŸš§  Skipping unsupported platform -- Try running with `-P windows=...`
[release/generate-windows-cuda] ğŸš§  Skipping unsupported platform -- Try running with `-P windows=...`
[release/build-linux-amd64    ] ğŸš§  Skipping unsupported platform -- Try running with `-P linux=...`
```

æŠ¥é”™** Skipping unsupported platform**

ä¸Šé¢çš„å‘½ä»¤åœ¨ intel amd64 æ¶æ„çš„ Apple ç¬”è®°æœ¬ä¸Šæ˜¯èƒ½æ­£ç¡®è¿è¡Œçš„ï¼š

```shell
# Apple amd64 æ¶æ„ èŠ¯ç‰‡èƒ½è¿è¡Œ amd 64 èŠ¯ç‰‡é•œåƒ
$ act -j 'test' pull_request
INFO[0000] Using docker host 'unix:///var/run/docker.sock', and daemon socket 'unix:///var/run/docker.sock'
INFO[0000] Start server on http://192.168.6.199:34567
[test/test-1] ğŸš€  Start image=adolphlwq/act-runner-ubuntu:22.04
[test/test-3] ğŸš€  Start image=adolphlwq/act-runner-ubuntu:22.04
[test/test-2] ğŸš§  Skipping unsupported platform -- Try running with `-P macos-latest=...`
[test/test-1]   ğŸ³  docker pull image=adolphlwq/act-runner-ubuntu:22.04 platform= username= forcePull=true
[test/test-3]   ğŸ³  docker pull image=adolphlwq/act-runner-ubuntu:22.04 platform= username= forcePull=true
[test/test-1]   ğŸ³  docker create image=adolphlwq/act-runner-ubuntu:22.04 platform= entrypoint=["tail" "-f" "/dev/null"] cmd=[] network="host"
[test/test-3]   ğŸ³  docker create image=adolphlwq/act-runner-ubuntu:22.04 platform= entrypoint=["tail" "-f" "/dev/null"] cmd=[] network="host"
[test/test-1]   ğŸ³  docker run image=adolphlwq/act-runner-ubuntu:22.04 platform= entrypoint=["tail" "-f" "/dev/null"] cmd=[] network="host"
[test/test-3]   ğŸ³  docker run image=adolphlwq/act-runner-ubuntu:22.04 platform= entrypoint=["tail" "-f" "/dev/null"] cmd=[] network="host"
[test/test-1]   â˜  git clone 'https://github.com/actions/setup-go' # ref=v5
[test/test-3]   â˜  git clone 'https://github.com/actions/setup-go' # ref=v5
[test/test-1] Non-terminating error while running 'git clone': some refs were not updated
[test/test-1]   â˜  git clone 'https://github.com/actions/upload-artifact' # ref=v4
[test/test-3] Non-terminating error while running 'git clone': some refs were not updated
[test/test-3]   â˜  git clone 'https://github.com/actions/upload-artifact' # ref=v4
^C[test/test-1] Cleaning up container for job test
[test/test-1] ğŸ  Job succeeded
[test/test-3] Cleaning up container for job test
[test/test-3] ğŸ  Job succeeded
Error: context canceled
```

å¯¹äºåƒ windows å’Œ mac è¿™æ ·çš„å¹³å°ï¼Œé•œåƒä¸å¥½è¿è¡Œï¼Œå¯ä»¥é€šè¿‡ `-P windows-latest=-self-hosted`å’Œ`-P macos-latest=-self-hosted` ç›´æ¥åœ¨å®¿ä¸»æœºä¸Šè¿è¡Œã€‚

```shell
act -P windows-latest=-self-hosted
act -P macos-latest=-self-hosted
```

## .actrc æ–‡ä»¶

act å‘½ä»¤çš„å‚æ•°è¿‡å¤šæ—¶ï¼Œå¯ä»¥æ”¾åˆ° `.actrc` æ–‡ä»¶ä¸­ï¼Œact è¿è¡Œæ—¶ï¼Œä¼šè‡ªåŠ¨å¯»æ‰¾å½“å‰ç›®å½•çš„ .actrc æ–‡ä»¶ï¼Œæ‰¾åˆ°åä¼šæŠŠå…¶ä¸­çš„å†…å®¹è§£æå‡ºæ¥ä½œä¸º act çš„å‚æ•°ã€‚

```actrc
-P ubuntu-latest=adolphlwq/act-runner-ubuntu:22.04
-P linux=adolphlwq/act-runner-ubuntu:22.04
-P macos-12=-self-hosted
--artifact-server-path /tmp/artifacts
```

ä¸Šé¢çš„ act æ–‡ä»¶ï¼Œç­‰åŒäºä¸‹é¢çš„å‘½ä»¤ï¼š

```shell
act -P ubuntu-latest=adolphlwq/act-runner-ubuntu:22.04 -P linux=adolphlwq/act-runner-ubuntu:22.04 -P macos-12=-self-hosted --artifact-server-path /tmp/artifacts
```
